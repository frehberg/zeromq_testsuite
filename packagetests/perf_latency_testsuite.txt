*** Settings ***
Library    Process
Test Template     Latency Test With MessageSize
Suite Teardown    Terminate All Processes    kill=True
Force Tags    package  latency

*** Variables ***
${LIBZMQ_ROOT}      %{LIBZMQ_ROOT}
${PERF_DIR}         %{LIBZMQ_ROOT}/perf
${ROUNDTRIP_COUNT}  4096
	
*** Test Cases ***    
Latency Test With MessageSize 32       32
Latency Test With MessageSize 64       64  
Latency Test With MessageSize 128     128  
Latency Test With MessageSize 256     256  
Latency Test With MessageSize 512     512  
Latency Test With MessageSize 1024   1024  
Latency Test With MessageSize 2048   2048 
Latency Test With MessageSize 4096   4096  


*** Keywords ***
Latency Test With MessageSize 
        [Arguments]   ${message_size} 
	${local_proc} =    Start Process     ${PERF_DIR}/local_lat   tcp://127.0.0.1:5555   ${message_size}   ${ROUNDTRIP_COUNT}
	${remote_proc} =    Start Process     ${PERF_DIR}/remote_lat   tcp://127.0.0.1:5555   ${message_size}   ${ROUNDTRIP_COUNT} 
	
        ${result} =   Wait For Process    ${local_proc}    timeout=30s    handle_timeout=kill
        Process Should Be Stopped    ${local_proc}
        Should Be Equal As Integers   ${result.rc}   0  
	Log      ${result.stdout}
	${result} =   Wait For Process    ${remote_proc}    timeout=30s    handle_timeout=kill
        Process Should Be Stopped    ${remote_proc}
        Should Be Equal As Integers   ${result.rc}   0  
	Log      ${result.stdout}
